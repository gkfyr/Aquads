!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Aquads={})}(this,function(t){"use strict";let e="";function n(t){e=t||""}async function o(t,n){const o=(await fetch(`${e}/api/slot/${n}/current`).then(t=>t.json())).latestMetaCid;if(!o)return void i(t,"No creative yet");const l=await a(o);if(!c(l))return void i(t,"Rejected by policy");s(t,l.width,l.height);const u=new Image;u.src=r(l.img_cid),u.style.width="100%",u.style.height="100%",u.style.objectFit="cover";const f=document.createElement("div");f.style.position="relative",f.style.width="100%",f.style.height="100%",f.appendChild(u);if(!(!0===window.__AQUADS_HIDE_LABEL||!0===window.__SUI_AD_HIDE_LABEL)){const t=document.createElement("div");t.textContent="Ad by Aquads",t.style.position="absolute",t.style.right="6px",t.style.bottom="6px",t.style.padding="2px 6px",t.style.font="10px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif",t.style.color="#fff",t.style.background="rgba(0,0,0,0.45)",t.style.borderRadius="4px",t.style.pointerEvents="none",t.style.userSelect="none",f.appendChild(t)}u.onload=()=>{u.onclick=()=>{fetch(`${e}/api/track/click`,{method:"POST",body:JSON.stringify({slotId:n,url:l.landing_url})}).catch(()=>{}),window.location.href=l.landing_url}},u.onerror=()=>{i(t,"Image failed to load")},t.replaceChildren(f);try{d(t,{slotId:n})}catch(t){}}function i(t,e){t.innerHTML=`<div style="display:flex;align-items:center;justify-content:center;background:#f2f3f5;color:#666;border:1px dashed #ccc;width:100%;height:100%;font:12px sans-serif;">${e}</div>`}function s(t,e,n){t.style.width=`${e}px`,t.style.height=`${n}px`}function r(t){return t.startsWith("mock://")?`/uploads/${t.replace(/^mock:\/\//,"")}`:t.startsWith("walrus://")?t.replace("walrus://",window.WALRUS_HTTP_GATEWAY||"https://walrus.testnet/ipfs/"):t}async function a(t){if(t.startsWith("mock://sha256-")){const e=t.replace("mock://sha256-","");return fetch(`/uploads/${e}.json`).then(t=>t.json())}const e=r(t);return fetch(e).then(t=>t.json())}function c(t){return!(!0!==window.__SEAL_DISABLE)||/^sha256:[0-9a-fA-F]{64}$/.test(t.checksum)}const l={mount:(t,e={})=>{var n,i;const s="string"==typeof t?document.querySelector(t):t,r=e.slotId||(null===(n=null==s?void 0:s.dataset)||void 0===n?void 0:n.slotId)||(null===(i=document.currentScript)||void 0===i?void 0:i.getAttribute("data-slot"))||"";s&&r&&o(s,r)},setApiBase:n};function d(t,n){var o,i;const s=null!==(o=n.thresholdPct)&&void 0!==o?o:.5,r=null!==(i=n.minDurationMs)&&void 0!==i?i:1e3;let a=0,c=0,l=0,d=performance.now(),u="visible"===document.visibilityState;const f=Array.from({length:21},(t,e)=>e/20),h=new IntersectionObserver(t=>{const e=t[0];a=e.intersectionRatio,a>c&&(c=a)},{root:null,threshold:f});h.observe(t);const p=()=>{u="visible"===document.visibilityState,d=performance.now()};document.addEventListener("visibilitychange",p);const y=setInterval(()=>{var t;const o=performance.now(),i=o-d;if(d=o,u&&a>=s&&(l+=i),l>=r){try{const o={slotId:n.slotId,maxPct:Math.round(100*c),durationMs:Math.round(l),ts:Date.now()};(null===(t=navigator.sendBeacon)||void 0===t?void 0:t.call(navigator,`${e}/api/track/view`,new Blob([JSON.stringify(o)],{type:"application/json"})))||fetch(`${e}/api/track/view`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})}catch(t){}v()}},250);function v(){clearInterval(y),h.disconnect(),document.removeEventListener("visibilitychange",p)}return{stop:v}}window.Aquads=l,window.SuiAds=l,t.enforceSize=s,t.fetchWalrusJSON=a,t.mount=o,t.renderPlaceholder=i,t.setApiBase=n,t.startViewability=d,t.verifySeal=c,t.walrusToHttp=r});
//# sourceMappingURL=sui-ads.umd.js.map
