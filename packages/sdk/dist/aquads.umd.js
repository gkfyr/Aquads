!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Aquads={})}(this,function(t){"use strict";let e="";function n(t){e=t||""}async function o(t,n){const o=(await fetch(`${e}/api/slot/${n}/current`).then(t=>t.json())).latestMetaCid;if(!o)return void i(t,"No creative yet");const c=await a(o);if(!r(c))return void i(t,"Rejected by policy");s(t,c.width,c.height);if("html"===c.type||!c.img_cid&&(c.title||c.subtitle)){const o=document.createElement("div");o.style.position="relative",o.style.width="100%",o.style.height="100%";const i=c.bg||"linear-gradient(135deg,#0ea5e9,#7c3aed)";o.style.background=i,o.style.color="#fff",o.style.display="flex",o.style.flexDirection="column",o.style.alignItems="center",o.style.justifyContent="center",o.style.textAlign="center",o.style.padding="8px";const s=document.createElement("div");s.textContent=c.title||"Aquads",s.style.font="700 18px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif";const l=document.createElement("div");l.textContent=c.subtitle||"Fast. Simple Ads. Powered by SUI",l.style.font="12px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif",l.style.opacity="0.9",o.appendChild(s),l.textContent&&o.appendChild(l);if(!(!0===window.__AQUADS_HIDE_LABEL||!0===window.__SUI_AD_HIDE_LABEL)){const t=document.createElement("div");t.textContent="Ad by Aquads",t.style.position="absolute",t.style.right="6px",t.style.bottom="6px",t.style.padding="2px 6px",t.style.font="10px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif",t.style.color="#fff",t.style.background="rgba(0,0,0,0.45)",t.style.borderRadius="4px",t.style.pointerEvents="none",t.style.userSelect="none",o.appendChild(t)}const a=document.createElement("div"),r=t=>{const e=String(t||""),n=e.startsWith("0x")?e.slice(2):e;return"0x"+n.slice(0,6)+(n.length>6?"â€¦":"")};a.textContent=n?`Slot: ${r(String(n))}`:"",a.style.position="absolute",a.style.left="6px",a.style.bottom="6px",a.style.padding="2px 6px",a.style.font='10px/1.2 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',a.style.color="#fff",a.style.background="rgba(0,0,0,0.35)",a.style.borderRadius="4px",a.style.pointerEvents="none",a.style.userSelect="none",a.style.maxWidth="70%",a.style.whiteSpace="nowrap",a.style.overflow="hidden",a.style.textOverflow="ellipsis",a.textContent&&o.appendChild(a),o.onclick=()=>{try{fetch(`${e}/api/track/click`,{method:"POST",body:JSON.stringify({slotId:n,url:c.landing_url})}).catch(()=>{})}catch(t){}c.landing_url&&(window.location.href=c.landing_url)},t.replaceChildren(o)}else{const o=new Image;o.src=l(c.img_cid),o.style.width="100%",o.style.height="100%",o.style.objectFit="cover";const s=document.createElement("div");s.style.position="relative",s.style.width="100%",s.style.height="100%",s.appendChild(o);if(!(!0===window.__AQUADS_HIDE_LABEL||!0===window.__SUI_AD_HIDE_LABEL)){const t=document.createElement("div");t.textContent="Ad by Aquads",t.style.position="absolute",t.style.right="6px",t.style.bottom="6px",t.style.padding="2px 6px",t.style.font="10px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif",t.style.color="#fff",t.style.background="rgba(0,0,0,0.45)",t.style.borderRadius="4px",t.style.pointerEvents="none",t.style.userSelect="none",s.appendChild(t)}o.onload=()=>{o.onclick=()=>{fetch(`${e}/api/track/click`,{method:"POST",body:JSON.stringify({slotId:n,url:c.landing_url})}).catch(()=>{}),window.location.href=c.landing_url}},o.onerror=()=>{i(t,"Image failed to load")},t.replaceChildren(s)}try{d(t,{slotId:n})}catch(t){}}function i(t,e){t.innerHTML=`<div style="display:flex;align-items:center;justify-content:center;background:#f2f3f5;color:#666;border:1px dashed #ccc;width:100%;height:100%;font:12px sans-serif;">${e}</div>`}function s(t,e,n){var o;if(t.hasAttribute("data-responsive")||"true"===(null===(o=t.dataset)||void 0===o?void 0:o.responsive))return t.style.width="100%",t.style.aspectRatio=`${e} / ${n}`,void(t.style.height="auto");t.style.width=`${e}px`,t.style.height=`${n}px`}function l(t){return t.startsWith("mock://")?`/uploads/${t.replace(/^mock:\/\//,"")}`:t.startsWith("walrus://")?t.replace("walrus://",window.WALRUS_HTTP_GATEWAY||"https://walrus.testnet/ipfs/"):t}async function a(t){if(t.startsWith("mock://sha256-")){const e=t.replace("mock://sha256-","");return fetch(`/uploads/${e}.json`).then(t=>t.json())}const e=l(t);return fetch(e).then(t=>t.json())}function r(t){return!(!0!==window.__SEAL_DISABLE)||/^sha256:[0-9a-fA-F]{64}$/.test(t.checksum)}const c={mount:(t,e={})=>{var n,i;const s="string"==typeof t?document.querySelector(t):t,l=e.slotId||(null===(n=null==s?void 0:s.dataset)||void 0===n?void 0:n.slotId)||(null===(i=document.currentScript)||void 0===i?void 0:i.getAttribute("data-slot"))||"";s&&l&&o(s,l)},setApiBase:n};function d(t,n){var o,i;const s=null!==(o=n.thresholdPct)&&void 0!==o?o:.5,l=null!==(i=n.minDurationMs)&&void 0!==i?i:1e3;let a=0,r=0,c=0,d=performance.now(),p="visible"===document.visibilityState;const y=Array.from({length:21},(t,e)=>e/20),u=new IntersectionObserver(t=>{const e=t[0];a=e.intersectionRatio,a>r&&(r=a)},{root:null,threshold:y});u.observe(t);const f=()=>{p="visible"===document.visibilityState,d=performance.now()};document.addEventListener("visibilitychange",f);const h=setInterval(()=>{var t;const o=performance.now(),i=o-d;if(d=o,p&&a>=s&&(c+=i),c>=l){try{const o={slotId:n.slotId,maxPct:Math.round(100*r),durationMs:Math.round(c),ts:Date.now()};(null===(t=navigator.sendBeacon)||void 0===t?void 0:t.call(navigator,`${e}/api/track/view`,new Blob([JSON.stringify(o)],{type:"application/json"})))||fetch(`${e}/api/track/view`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})}catch(t){}m()}},250);function m(){clearInterval(h),u.disconnect(),document.removeEventListener("visibilitychange",f)}return{stop:m}}window.Aquads=c,window.SuiAds=c,t.enforceSize=s,t.fetchWalrusJSON=a,t.mount=o,t.renderPlaceholder=i,t.setApiBase=n,t.startViewability=d,t.verifySeal=r,t.walrusToHttp=l});
//# sourceMappingURL=aquads.umd.js.map
